{{ define "title" }}{{ if .Job }}Edit Job{{ else }}New Job{{ end }} - Cronnor{{ end }}

{{ define "extra_head" }}
<script src="/static/js/script.js" defer></script>
{{ end }}

{{ define "content" }}
<div class="max-w-5xl mx-auto">
    <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-6 gap-4">
        <h2 class="text-2xl font-bold">{{ if .Job }}Edit Job{{ else }}Create New Job{{ end }}</h2>
        <div class="flex gap-3">
            <button type="submit" form="job-form" class="px-4 py-2 rounded-lg text-sm font-semibold transition-all bg-primary text-white hover:bg-primary-dark">
                {{ if .Job }}Update{{ else }}Create{{ end }}
            </button>
            <a href="/jobs" class="px-4 py-2 rounded-lg text-sm font-semibold transition-all bg-secondary text-white hover:bg-surface-light">Cancel</a>
        </div>
    </div>

    <form 
        id="job-form"
        {{ if .Job }}
        action="/jobs/{{ .Job.ID }}" 
        {{ else }}
        action="/jobs"
        {{ end }}
        method="POST"
        class="grid grid-cols-1 lg:grid-cols-3 gap-6"
    >
        <div class="bg-surface p-6 rounded-xl border border-border">
            <h3 class="text-base font-bold text-primary uppercase tracking-wide mb-4">Basic Info</h3>
            <div class="mb-4 last:mb-0">
                <label for="name" class="block mb-1.5 font-semibold text-text-muted text-xs uppercase tracking-wide">Job Name</label>
                <input 
                    type="text" 
                    id="name" 
                    name="name" 
                    required
                    {{ if .Job }}value="{{ .Job.Name }}"{{ end }}
                    placeholder="Daily Health Check"
                    class="w-full px-3 py-2.5 bg-background border border-border rounded-md text-text text-sm focus:outline-none focus:border-primary transition-colors"
                >
            </div>

            <div class="mb-4 last:mb-0">
                <label for="url" class="block mb-1.5 font-semibold text-text-muted text-xs uppercase tracking-wide">Target URL</label>
                <input 
                    type="url" 
                    id="url" 
                    name="url" 
                    required
                    {{ if .Job }}value="{{ .Job.URL }}"{{ end }}
                    placeholder="https://api.example.com/webhook"
                    class="w-full px-3 py-2.5 bg-background border border-border rounded-md text-text text-sm focus:outline-none focus:border-primary transition-colors"
                >
            </div>

            <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
                <div class="mb-4 last:mb-0">
                    <label for="method" class="block mb-1.5 font-semibold text-text-muted text-xs uppercase tracking-wide">Method</label>
                    <select id="method" name="method" required class="w-full px-3 py-2.5 bg-background border border-border rounded-md text-text text-sm focus:outline-none focus:border-primary transition-colors">
                        <option value="GET" {{ if and .Job (eq .Job.Method "GET") }}selected{{ end }}>GET</option>
                        <option value="POST" {{ if and .Job (eq .Job.Method "POST") }}selected{{ else if not .Job }}selected{{ end }}>POST</option>
                        <option value="PUT" {{ if and .Job (eq .Job.Method "PUT") }}selected{{ end }}>PUT</option>
                        <option value="PATCH" {{ if and .Job (eq .Job.Method "PATCH") }}selected{{ end }}>PATCH</option>
                        <option value="DELETE" {{ if and .Job (eq .Job.Method "DELETE") }}selected{{ end }}>DELETE</option>
                    </select>
                </div>
            </div>
        </div>

        <div class="bg-surface p-6 rounded-xl border border-border">
            <h3 class="text-base font-bold text-primary uppercase tracking-wide mb-4">Schedule</h3>
            <div class="mb-4 last:mb-0">
                <label for="schedule_type" class="block mb-1.5 font-semibold text-text-muted text-xs uppercase tracking-wide">Type</label>
                <select id="schedule_type" onchange="updateCronExpression()" class="w-full px-3 py-2.5 bg-background border border-border rounded-md text-text text-sm focus:outline-none focus:border-primary transition-colors">
                    <option value="preset">Presets</option>
                    <option value="simple">Simple</option>
                    <option value="custom">Custom</option>
                </select>
            </div>

            <div id="preset_options" class="mb-4 last:mb-0">
                <label for="preset_select" class="block mb-1.5 font-semibold text-text-muted text-xs uppercase tracking-wide">Frequency</label>
                <select id="preset_select" onchange="updateCronExpression()" class="w-full px-3 py-2.5 bg-background border border-border rounded-md text-text text-sm focus:outline-none focus:border-primary transition-colors">
                    <option value="0 */5 * * * *">Every 5 min</option>
                    <option value="0 */15 * * * *">Every 15 min</option>
                    <option value="0 */30 * * * *">Every 30 min</option>
                    <option value="0 0 * * * *">Hourly</option>
                    <option value="0 0 */2 * * *">Every 2 hours</option>
                    <option value="0 0 */6 * * *">Every 6 hours</option>
                    <option value="0 0 0 * * *">Daily midnight</option>
                    <option value="0 0 9 * * *">Daily 9 AM</option>
                    <option value="0 0 12 * * *">Daily noon</option>
                    <option value="0 0 0 * * 0">Weekly Sun</option>
                    <option value="0 0 0 * * 1">Weekly Mon</option>
                    <option value="0 0 0 1 * *">Monthly 1st</option>
                </select>
            </div>

            <div id="simple_builder" style="display: none;">
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
                    <div class="mb-4 last:mb-0">
                        <label for="simple_interval" class="block mb-1.5 font-semibold text-text-muted text-xs uppercase tracking-wide">Every</label>
                        <input type="number" id="simple_interval" value="5" min="1" onchange="updateCronExpression()" class="w-full px-3 py-2.5 bg-background border border-border rounded-md text-text text-sm focus:outline-none focus:border-primary transition-colors">
                    </div>
                    <div class="mb-4 last:mb-0">
                        <label for="simple_unit" class="block mb-1.5 font-semibold text-text-muted text-xs uppercase tracking-wide">Unit</label>
                        <select id="simple_unit" onchange="updateCronExpression()" class="w-full px-3 py-2.5 bg-background border border-border rounded-md text-text text-sm focus:outline-none focus:border-primary transition-colors">
                            <option value="minutes">Min</option>
                            <option value="hours">Hours</option>
                            <option value="days">Days</option>
                        </select>
                    </div>
                </div>
                <div id="time_picker" class="mb-4 last:mb-0" style="display: none;">
                    <label for="simple_time" class="block mb-1.5 font-semibold text-text-muted text-xs uppercase tracking-wide">At</label>
                    <input type="time" id="simple_time" value="00:00" onchange="updateCronExpression()" class="w-full px-3 py-2.5 bg-background border border-border rounded-md text-text text-sm focus:outline-none focus:border-primary transition-colors">
                </div>
            </div>

            <div id="custom_input" class="mb-4 last:mb-0" style="display: none;">
                <label for="custom_cron" class="block mb-1.5 font-semibold text-text-muted text-xs uppercase tracking-wide">Expression</label>
                <input 
                    type="text" 
                    id="custom_cron" 
                    placeholder="* * * * *"
                    class="w-full px-3 py-2.5 bg-background border border-border rounded-md text-text text-sm focus:outline-none focus:border-primary transition-colors font-mono"
                    onchange="updateCronExpression()"
                >
            </div>

            <div class="mt-4 pt-4 border-t border-border">
                <input 
                    type="text" 
                    id="cron_expr" 
                    name="cron_expr" 
                    required
                    {{ if .Job }}value="{{ .Job.CronExpr }}"{{ end }}
                    placeholder="*/5 * * * *"
                    class="w-full px-3 py-2.5 bg-background border border-primary rounded-md text-text text-sm mb-1.5 font-mono focus:outline-none"
                    readonly
                >
                <small id="cron_description" class="block text-xs font-semibold text-primary">Every 5 minutes</small>
            </div>
        </div>

        <div class="bg-surface p-6 rounded-xl border border-border lg:col-span-3">
            <h3 class="text-base font-bold text-primary uppercase tracking-wide mb-4">Payload (Optional)</h3>
            <textarea 
                id="payload" 
                name="payload" 
                rows="4"
                placeholder='{"key": "value"}'
                class="w-full px-3 py-2.5 bg-background border border-border rounded-md text-text text-sm focus:outline-none focus:border-primary transition-colors font-mono"
            >{{ if and .Job .Job.Payload.Valid }}{{ .Job.Payload.String }}{{ end }}</textarea>
        </div>
    </form>
</div>
{{ end }}

{{ template "layout.html" . }}
