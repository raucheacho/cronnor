{{ define "title" }}{{ .Job.Name }} - Cronnor{{ end }}

{{ define "extra_head" }}
<script src="https://unpkg.com/htmx.org@1.9.10"></script>
{{ end }}

{{ define "content" }}
<div class="max-w-4xl mx-auto">
  <div class="flex justify-between items-start mb-8">
    <div>
      <h2 class="text-3xl font-bold mb-2">{{ .Job.Name }}</h2>
      <span class="inline-block px-3 py-1 rounded-md text-sm font-semibold {{ statusClass .Job.LastStatus.String }}">
        {{ if .Job.LastStatus.Valid }}{{ .Job.LastStatus.String }}{{ else }}PENDING{{ end }}
      </span>
    </div>
    <div class="flex gap-3">
      <a href="/jobs/{{ .Job.ID }}/edit" class="px-4 py-2 rounded-lg text-sm font-semibold transition-all bg-primary text-white hover:bg-primary-dark">Edit</a>
      <a href="/jobs" class="px-4 py-2 rounded-lg text-sm font-semibold transition-all bg-secondary text-white hover:bg-surface-light">← Back</a>
    </div>
  </div>

  <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
    <div class="bg-surface p-6 rounded-xl border border-border">
      <h3 class="text-xl font-semibold text-primary mb-4">Configuration</h3>
      <div class="flex py-2 border-b border-surface-light gap-4">
        <span class="font-semibold text-text-muted min-w-[100px]">URL:</span>
        <span class="text-text break-all">{{ .Job.URL }}</span>
      </div>
      <div class="flex py-2 border-b border-surface-light gap-4">
        <span class="font-semibold text-text-muted min-w-[100px]">Method:</span>
        <span class="text-text">{{ .Job.Method }}</span>
      </div>
      <div class="flex py-2 border-b border-surface-light gap-4">
        <span class="font-semibold text-text-muted min-w-[100px]">Cron Expression:</span>
        <span class="font-mono bg-background px-2 py-1 rounded text-sm">{{ .Job.CronExpr }}</span>
      </div>
      {{ if .Job.Payload.Valid }}
      <div class="flex py-2 border-b border-surface-light gap-4">
        <span class="font-semibold text-text-muted min-w-[100px]">Payload:</span>
        <pre class="bg-background p-3 rounded-lg overflow-x-auto font-mono text-sm w-full">{{ .Job.Payload.String }}</pre>
      </div>
      {{ end }}
    </div>

    <div class="bg-surface p-6 rounded-xl border border-border">
      <h3 class="text-xl font-semibold text-primary mb-4">Status</h3>
      <div class="flex py-2 border-b border-surface-light gap-4">
        <span class="font-semibold text-text-muted min-w-[100px]">Active:</span>
        <span class="text-text"
          >{{ if .Job.IsActive }}✅ Yes{{ else }}❌ No{{ end }}</span
        >
      </div>
      <div class="flex py-2 border-b border-surface-light gap-4">
        <span class="font-semibold text-text-muted min-w-[100px]">Created:</span>
        <span class="text-text">{{ formatTime .Job.CreatedAt }}</span>
      </div>
      {{ if .Job.LastRunAt.Valid }}
      <div class="flex py-2 border-b border-surface-light gap-4">
        <span class="font-semibold text-text-muted min-w-[100px]">Last Run:</span>
        <span class="text-text">{{ formatTime .Job.LastRunAt.Time }}</span>
      </div>
      {{ end }}
      <div class="flex py-2 border-b border-surface-light gap-4">
        <span class="font-semibold text-text-muted min-w-[100px]">Next Run:</span>
        <span class="text-text">{{ nextRun .Job.CronExpr }}</span>
      </div>
    </div>
  </div>

  <div class="bg-surface p-6 rounded-xl border border-border">
    <h3 class="text-xl font-semibold text-primary mb-4">Execution History</h3>
    {{ if not .Logs }}
    <p class="text-text-muted text-center p-4">
      No execution logs yet. The job hasn't run.
    </p>
    {{ else }}
    <div class="overflow-x-auto">
      <table class="w-full border-collapse">
        <thead>
          <tr>
            <th class="bg-background font-semibold text-text-muted p-3 text-left border-b border-border">Time</th>
            <th class="bg-background font-semibold text-text-muted p-3 text-left border-b border-border">Status</th>
            <th class="bg-background font-semibold text-text-muted p-3 text-left border-b border-border">HTTP Code</th>
            <th class="bg-background font-semibold text-text-muted p-3 text-left border-b border-border">Duration</th>
            <th class="bg-background font-semibold text-text-muted p-3 text-left border-b border-border">Details</th>
          </tr>
        </thead>
        <tbody>
          {{ range .Logs }}
          <tr class="hover:bg-surface-light transition-colors">
            <td class="p-3 border-b border-border">{{ formatTime .CreatedAt }}</td>
            <td class="p-3 border-b border-border">
              <span class="inline-block px-3 py-1 rounded-md text-sm font-semibold {{ statusClass .Status }}">
                {{ .Status }}
              </span>
            </td>
            <td class="p-3 border-b border-border">
              {{ if .HTTPCode.Valid }}{{ .HTTPCode.Int64 }}{{ else }}-{{
              end }}
            </td>
            <td class="p-3 border-b border-border">
              {{ if .DurationMs.Valid }}{{ .DurationMs.Int64 }}ms{{ else
              }}-{{ end }}
            </td>
            <td class="p-3 border-b border-border">
              {{ if .ErrorMessage.Valid }}
              <span class="text-danger text-sm"
                >{{ .ErrorMessage.String }}</span
              >
              {{ else if .ResponseBody.Valid }}
              <details>
                <summary class="cursor-pointer text-primary hover:text-primary-dark">Response</summary>
                <pre class="mt-2 p-2 bg-background rounded text-xs overflow-x-auto">{{ .ResponseBody.String }}</pre>
              </details>
              {{ else }} - {{ end }}
            </td>
          </tr>
          {{ end }}
        </tbody>
      </table>
    </div>
    {{ end }}
  </div>
</div>
{{ end }}

{{ template "layout.html" . }}
